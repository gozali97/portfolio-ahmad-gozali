# Supabase Setup Instructions

To make the portfolio work with dynamic data, please follow these steps:

1.  **Create a Project** at [Supabase.com](https://supabase.com).
2.  **Go to SQL Editor** in your Supabase dashboard.
3.  **Run the following SQL** to create the tables and security policies:

\`\`\`sql
sql
-- 1. Bersihkan tabel lama jika ada (Optional, agar bersih)
drop table if exists public.projects;
drop table if exists public.tech_stacks;

-- 2. Buat Tabel Projects
create table public.projects (
  id bigint generated by default as identity primary key,
  title text not null,
  short_description text,
  full_description text,
  image_url text,
  technologies text[],
  category text,
  demo_url text,
  repo_url text,
  is_live boolean default false,
  highlights text[],
  created_at timestamp with time zone default timezone('utc'::text, now())
);

-- 3. Buat Tabel Tech Stacks
create table public.tech_stacks (
  id bigint generated by default as identity primary key,
  name text not null,
  image_url text,
  category text,
  proficiency integer default 0,
  years integer default 0,
  "desc" text,
  created_at timestamp with time zone default timezone('utc'::text, now())
);

-- 4. Aktifkan RLS
alter table public.projects enable row level security;
alter table public.tech_stacks enable row level security;

-- 5. Policies untuk PROJECTS
-- Public View
create policy "Public projects view"
on public.projects for select using (true);

-- Admin Modify (ALL covers Select, Insert, Update, Delete)
create policy "Admin modify projects"
on public.projects for all
using (auth.role() = 'authenticated')
with check (auth.role() = 'authenticated');

-- 6. Policies untuk TECH STACKS
-- Public View
create policy "Public tech_stacks view"
on public.tech_stacks for select using (true);

-- Admin Modify
create policy "Admin modify tech_stacks"
on public.tech_stacks for all
using (auth.role() = 'authenticated')
with check (auth.role() = 'authenticated');

-- 7. Setup Storage (Bucket & Policies)
insert into storage.buckets (id, name, public)
values ('portfolio-images', 'portfolio-images', true)
on conflict (id) do nothing;

-- Policy Storage: Public View
-- Drop policy jika sudah ada (untuk menghindari error duplikat saat re-run)
drop policy if exists "Public Access Images" on storage.objects;
create policy "Public Access Images"
on storage.objects for select using ( bucket_id = 'portfolio-images' );

-- Policy Storage: Admin Upload (PERBAIKAN UTAMA DI SINI)
-- Menggunakan WITH CHECK untuk insert
drop policy if exists "Auth Upload Images" on storage.objects;
create policy "Auth Upload Images"
on storage.objects for insert
with check ( bucket_id = 'portfolio-images' and auth.role() = 'authenticated' );

-- Policy Storage: Admin Delete/Update
drop policy if exists "Auth Manage Images" on storage.objects;
create policy "Auth Manage Images"
on storage.objects for update
using ( bucket_id = 'portfolio-images' and auth.role() = 'authenticated' );

create policy "Auth Delete Images"
on storage.objects for delete
using ( bucket_id = 'portfolio-images' and auth.role() = 'authenticated' );
\`\`\`

4.  **Get API Keys:**
    *   Go to Project Settings -> API.
    *   Copy `URL` and `anon` public key.

5.  **Update .env:**
    *   Create a `.env` file in the root of your project.
    *   Add:
        \`\`\`
        REACT_APP_SUPABASE_URL=your_supabase_url
        REACT_APP_SUPABASE_ANON_KEY=your_supabase_anon_key
        \`\`\`
